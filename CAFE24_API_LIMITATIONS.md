# 카페24 API 실제 가능 범위

## 개요

장할톡 서비스는 카페24 API를 활용하여 실제로 구현 가능한 범위 내에서 동작합니다. 이 문서는 실제 카페24 API의 제약사항과 가능한 기능을 정리합니다.

## 실제 카페24 API로 가능한 것

### 1. 장바구니 목록 조회

**API 엔드포인트:**
```
GET /api/v2/admin/orders/carts
```

**가능한 정보:**
- 장바구니 번호 (`cart_no`)
- 고객 이름 (`customer_name`)
- 고객 전화번호 (`customer_phone`)
- 상품 정보 (상품명, 가격)
- 장바구니 생성일 (`created_date`)
- 장바구니 상태 (이탈/구매완료)
- 장바구니 금액 (`total_amount`)

**제한사항:**
- 페르소나 정보(고객 등급, 구매 이력)는 별도 고객 API 호출 필요
- 마케팅 동의 여부는 장바구니 API에서 직접 제공되지 않을 수 있음
- 필터링 옵션이 제한적 (클라이언트 측 필터링 필요)

### 2. 고객 정보 조회 (별도 API 필요)

**API 엔드포인트:**
```
GET /api/v2/admin/customers/{customer_id}
```

**가능한 정보:**
- 고객 등급 (`customer_group`)
- 구매 이력 건수 (별도 주문 조회 필요)
- 최근 구매일 (별도 주문 조회 필요)
- 선호 카테고리 (분석 필요)
- 평균 주문 금액 (계산 필요)

**제한사항:**
- 장바구니 목록과 별도로 API 호출 필요
- 고객 ID가 있어야 조회 가능
- 일부 정보는 추가 계산/분석 필요

### 3. 주문 정보 조회

**API 엔드포인트:**
```
GET /api/v2/admin/orders
```

**가능한 정보:**
- 주문 상태
- 결제 정보
- 전환 여부 확인

## 불확실하거나 제한적인 것

### 1. 장바구니 복원 API

**현재 구현:**
```
POST /api/v2/admin/orders/carts/{cart_no}/restore
```

**문제점:**
- 해당 엔드포인트의 실제 존재 여부 불확실
- 카페24 API 문서에서 확인 필요

**대안:**
- 장바구니 번호로 `orderform.html` URL 생성 후 리다이렉트
- 실제 복원은 카페24 쇼핑몰에서 처리

### 2. 자동 이탈 감지

**이상적인 방법:**
- 웹훅(Webhook)을 통한 실시간 감지

**현실적인 방법:**
- 주기적 폴링 (예: 1시간마다 장바구니 목록 조회)
- 이탈 장바구니 감지 (구매 완료되지 않은 것)

**제한사항:**
- 카페24 웹훅 지원 여부 확인 필요
- 실시간 감지는 어려울 수 있음

### 3. 페르소나 정보

**현재 구현:**
- Mock 데이터로 표시

**실제 구현:**
- 고객 API 별도 호출 필요
- 장바구니 목록과 고객 정보를 매칭하는 로직 필요
- 추가 API 호출로 인한 성능 이슈 고려

### 4. 마케팅 동의 여부

**현재 구현:**
- `marketing_consent` 필드 가정

**실제:**
- 장바구니 API에서 직접 제공 여부 불확실
- 고객 API에서 확인하거나 별도 필드 확인 필요
- 개인정보보호법 준수 필요

### 5. 결제 수단 지정

**현재 구현:**
- URL 파라미터로 `payment_method` 전달

**실제:**
- 카페24에서 지원 여부 불확실
- 장할특 결제수단을 URL로 지정할 수 있는지 확인 필요
- 토스페이먼츠 연동 방식 확인 필요

## 실제 구현 가능한 워크플로우

### 1. 장바구니 이탈 감지
```
1. 주기적으로 장바구니 목록 조회 (1시간마다)
2. 이탈 장바구니 감지 (구매 완료되지 않은 것)
3. 고객 정보 조회 (별도 API 호출)
4. 마케팅 동의 확인
5. 알림톡 발송
6. 장바구니 복원 링크 제공 (URL 생성)
```

### 2. 데이터 수집
```
- 장바구니 목록: GET /api/v2/admin/orders/carts
- 고객 정보: GET /api/v2/admin/customers/{customer_id}
- 주문 정보: GET /api/v2/admin/orders (전환 확인용)
```

### 3. 제약사항
- API 호출 제한: Rate limiting 고려 필요
- 추가 API 호출: 고객 정보 조회 시 성능 이슈
- 실시간 감지: 웹훅 없이는 주기적 폴링만 가능
- 페르소나 정보: 추가 비용(API 호출) 발생

## 현재 구현 상태

### 구현 완료
- [x] 카페24 OAuth 인증
- [x] 장바구니 목록 조회 (실제 API 호출)
- [x] 토큰 관리 및 갱신
- [x] 알림톡 발송 (카카오 API)

### 수정 필요
- [ ] 페르소나 정보: Mock 제거 또는 실제 API 호출
- [ ] 장바구니 복원: API 호출 제거, URL 생성만 사용
- [ ] 마케팅 동의: 실제 API 응답에 맞게 조정
- [ ] 자동 감지: 주기적 폴링 방식으로 변경
- [ ] 데이터 변환: 실제 카페24 API 응답 형식에 맞게 수정

## 참고 자료

- [카페24 개발자 센터](https://developers.cafe24.com)
- [카페24 API 문서](https://developers.cafe24.com/docs/api/admin/)

